<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>AR Ð¡Ð°Ñ‚ÑƒÑ€Ð½ â€” MindAR + Three.js</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      overflow: hidden;
      background-color: black;
    }
    #ar-container {
      width: 100%;
      height: 100%;
      position: relative;
    }
    #start-ar {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      z-index: 2;
      padding: 16px 32px;
      font-size: 18px;
      background: rgba(255,255,255,0.9);
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="ar-container">
    <button id="start-ar">Start AR</button>
  </div>

  <!-- MindAR Ð²Ð¶Ðµ Ð¼Ñ–ÑÑ‚Ð¸Ñ‚ÑŒ ÑÐ²Ð¾ÑŽ Ð²ÐµÑ€ÑÑ–ÑŽ Three.js -->
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.1.5/dist/mindar-image-three.prod.js"></script>

  <script>
    window.addEventListener("load", () => {
      const waitForMindAR = () => {
        if (window.MINDAR?.IMAGE?.MindARThree && window.THREE) {
          runApp();
        } else {
          setTimeout(waitForMindAR, 50);
        }
      };
      waitForMindAR();

      function runApp() {
        const THREE = window.THREE;
        const { MindARThree } = window.MINDAR.IMAGE;

        const mindarThree = new MindARThree({
          container: document.querySelector("#ar-container"),
          imageTargetSrc: "assets/targets/targets.mind",
          uiScanning: false,
        });

        const { renderer, scene, camera } = mindarThree;
        const anchor = mindarThree.addAnchor(0);

        // ÐžÑÐ²Ñ–Ñ‚Ð»ÐµÐ½Ð½Ñ
        scene.add(
          new THREE.AmbientLight(0xffffff, 0.5),
          (() => {
            const light = new THREE.DirectionalLight(0xffffff, 1);
            light.position.set(0, 1, 1);
            return light;
          })()
        );

        // Ð¢ÐµÐºÑÑ‚ÑƒÑ€Ð¸
        const loader = new THREE.TextureLoader();
        const saturnTex = loader.load("assets/textures/saturn.jpg");
        const ringTex = loader.load("assets/textures/rings.jpg");

        // ÐœÐµÑˆÑ–
        const saturn = new THREE.Mesh(
          new THREE.SphereGeometry(2, 64, 64),
          new THREE.MeshStandardMaterial({ map: saturnTex, metalness: 0.2, roughness: 0.9 })
        );

        const rings = new THREE.Mesh(
          new THREE.RingGeometry(2.5, 4.5, 128),
          new THREE.MeshStandardMaterial({
            map: ringTex,
            side: THREE.DoubleSide,
            transparent: true,
            alphaTest: 0.5
          })
        );
        rings.rotation.x = -Math.PI / 2;

        const saturnGroup = new THREE.Group();
        saturnGroup.add(saturn, rings);
        saturnGroup.rotation.set(
          THREE.MathUtils.degToRad(-27),
          THREE.MathUtils.degToRad(120),
          0
        );

        anchor.group.add(saturnGroup);

        document.getElementById("start-ar").addEventListener("click", async () => {
          console.log("ðŸ”µ ÐšÐ½Ð¾Ð¿ÐºÐ° Ð½Ð°Ñ‚Ð¸ÑÐ½ÑƒÑ‚Ð°, Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ”Ð¼Ð¾ AR...");
          document.getElementById("start-ar").style.display = "none";

          try {
            await mindarThree.start();
            console.log("âœ… mindarThree.start() ÑƒÑÐ¿Ñ–ÑˆÐ½Ð¾ Ð²Ð¸ÐºÐ¾Ð½Ð°Ð½Ð¾");

            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setAnimationLoop(() => {
              saturnGroup.rotation.y += 0.005;
              renderer.render(scene, camera);
            });
          } catch (err) {
            console.error("âŒ ÐŸÐ¾Ð¼Ð¸Ð»ÐºÐ° Ð¿Ñ€Ð¸ Ð·Ð°Ð¿ÑƒÑÐºÑƒ MindAR:", err);
          }
        });

        window.addEventListener("resize", () => {
          renderer.setSize(window.innerWidth, window.innerHeight);
        });
      }
    });
  </script>
</body>
</html>
