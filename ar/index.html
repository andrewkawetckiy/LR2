<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>AR –°–∞—Ç—É—Ä–Ω ‚Äî MindAR + Three.js</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background: black;
    }
    #ar-container {
      position: relative;
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <div id="ar-container"></div>

  <!-- MindAR –∑ –≤–±—É–¥–æ–≤–∞–Ω–æ—é Three.js -->
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.1.5/dist/mindar-image-three.prod.js"></script>

  <script>
    window.addEventListener("load", () => {
      console.log("üåê –°—Ç–æ—Ä—ñ–Ω–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞");

      // üîç –ü–µ—Ä–µ–≤—ñ—Ä–∏–º–æ –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–º–µ—Ä–∏ –æ–∫—Ä–µ–º–æ
      if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        navigator.mediaDevices.getUserMedia({ video: true })
          .then(() => {
            console.log("‚úÖ –ö–∞–º–µ—Ä–∞ –¥–æ—Å—Ç—É–ø–Ω–∞");
          })
          .catch((err) => {
            console.error("üö´ –ö–∞–º–µ—Ä–∞ –Ω–µ –ø—Ä–∞—Ü—é—î –∞–±–æ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∞:", err);
          });
      } else {
        console.warn("‚ö†Ô∏è navigator.mediaDevices –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º");
      }

      // –ß–µ–∫–∞—î–º–æ, –ø–æ–∫–∏ MindAR —ñ THREE –±—É–¥—É—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ñ
      const waitReady = () => {
        if (window.MINDAR?.IMAGE?.MindARThree && window.THREE) {
          console.log("‚úÖ MindARThree —ñ THREE –¥–æ—Å—Ç—É–ø–Ω—ñ");
          runApp();
        } else {
          console.log("‚è≥ –ß–µ–∫–∞—î–º–æ –Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è MindAR / THREE...");
          setTimeout(waitReady, 100);
        }
      };
      waitReady();

      function runApp() {
        const THREE = window.THREE;
        const { MindARThree } = window.MINDAR.IMAGE;

        console.log("üöÄ –ó–∞–ø—É—Å–∫–∞—î–º–æ AR...");

        const mindarThree = new MindARThree({
          container: document.querySelector("#ar-container"),
          imageTargetSrc: "assets/targets/targets.mind",
          uiScanning: true,
          uiLoading: "yes"
        });

        const { renderer, scene, camera } = mindarThree;
        const anchor = mindarThree.addAnchor(0);

        // –û—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è
        console.log("üí° –î–æ–¥–∞—î–º–æ –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è...");
        const ambient = new THREE.AmbientLight(0xffffff, 0.5);
        const directional = new THREE.DirectionalLight(0xffffff, 1);
        directional.position.set(0, 1, 1);
        scene.add(ambient, directional);

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É—Ä
        const loader = new THREE.TextureLoader();
        console.log("üé® –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ç–µ–∫—Å—Ç—É—Ä–∏...");
        Promise.all([
          loader.loadAsync("assets/textures/saturn.jpg"),
          loader.loadAsync("assets/textures/rings.jpg")
        ]).then(([saturnTex, ringsTex]) => {
          console.log("‚úÖ –¢–µ–∫—Å—Ç—É—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ");

          const saturn = new THREE.Mesh(
            new THREE.SphereGeometry(0.5, 64, 64),
            new THREE.MeshStandardMaterial({ map: saturnTex, metalness: 0.2, roughness: 0.9 })
          );

          const rings = new THREE.Mesh(
            new THREE.RingGeometry(0.65, 1.15, 128),
            new THREE.MeshStandardMaterial({
              map: ringsTex,
              side: THREE.DoubleSide,
              transparent: true,
              alphaTest: 0.5
            })
          );
          rings.rotation.x = -Math.PI / 2;

          const group = new THREE.Group();
          group.add(saturn, rings);
          group.rotation.set(
            THREE.MathUtils.degToRad(-27),
            THREE.MathUtils.degToRad(120),
            0
          );
          anchor.group.add(group);

          // –ó–∞–ø—É—Å–∫ AR
          mindarThree.start().then(() => {
            console.log("‚úÖ mindarThree.start() —É—Å–ø—ñ—à–Ω–æ –≤–∏–∫–æ–Ω–∞–Ω–æ");
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setAnimationLoop(() => {
              group.rotation.y += 0.005;
              renderer.render(scene, camera);
            });
          }).catch((err) => {
            console.error("‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥ —á–∞—Å –∑–∞–ø—É—Å–∫—É MindAR:", err);
          });

          window.addEventListener("resize", () => {
            renderer.setSize(window.innerWidth, window.innerHeight);
          });

        }).catch((err) => {
          console.error("‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥ —á–∞—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É—Ä:", err);
        });
      }
    });
  </script>
</body>
</html>
